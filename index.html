<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Envio de Mensagem Ideal</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
    <style>
        :root {
            /* Company color palette */
            --primary-blue: #1a73e8;
            --secondary-blue: #4285f4;
            --light-blue: #e8f0fe;
            --dark-blue: #174ea6;
            --text-dark: #202124;
            --text-light: #5f6368;
            --white: #ffffff;
            --gray-100: #f8f9fa;
            --gray-200: #e9ecef;
            --gray-300: #dee2e6;
        }

        body {
            font-family: 'Inter', Arial, sans-serif;
            background: #f4f7fe;
            margin: 0;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            background: #fff;
            border-radius: 14px;
            box-shadow: 0 4px 24px rgba(37,99,235,0.08);
            padding: 2rem 1.5rem 1.5rem 1.5rem;
            max-width: 700px;
            width: 100%;
            margin: 2rem auto;
            box-sizing: border-box;
        }

        .form-label {
            font-weight: 600;
            margin-bottom: 0.25rem;
            display: block;
        }

        .form-control, .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 1rem;
            background: #f8fafc;
            transition: border 0.2s;
            box-sizing: border-box;
        }

        .form-control:focus, .form-select:focus {
            border-color: #2563eb;
            outline: none;
        }

        .payment-type-options {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .payment-type-option {
            flex: 1 1 200px;
            min-width: 180px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: #f8fafc;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: border 0.2s, background 0.2s;
        }

        .payment-type-option input[type="radio"] {
            accent-color: #2563eb;
            margin-right: 0.5rem;
        }

        .payment-type-option label {
            cursor: pointer;
            font-weight: 500;
            color: #2563eb;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            width: 100%;
            background: #2563eb;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 0.9rem 0;
            font-size: 1.1rem;
            font-weight: 600;
            margin-top: 1.5rem;
            cursor: pointer;
            transition: background 0.2s;
            box-shadow: 0 2px 8px rgba(37,99,235,0.08);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-primary:disabled {
            background: #bcd0fa;
            cursor: not-allowed;
        }

        h5 {
            font-size: 1.1rem;
            color: #2563eb;
            margin-bottom: 1rem;
            margin-top: 1.5rem;
        }

        @media (max-width: 700px) {
            .container {
                padding: 1rem 0.5rem;
                max-width: 100vw;
            }
            .payment-type-options {
                gap: 0.5rem;
                overflow-x: auto;
                flex-wrap: nowrap;
            }
            .payment-type-option {
                min-width: 180px;
                width: auto;
                flex: 0 0 auto;
            }
        }

        /* Logo and Header Styles */
        .logo-container {
            text-align: center;
            margin-bottom: 2rem;
        }

        .logo-container img {
            max-width: 180px;
            height: auto;
            margin-bottom: 1rem;
        }

        /* Main Container Styles */
        .main-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            background: var(--white);
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
            border-radius: 16px;
            position: relative;
            overflow: hidden;
        }

        .main-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-blue), var(--secondary-blue));
        }

        /* Tab Content Styles */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Form Styles */
        .form-label {
            font-weight: 500;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }

        .form-control, .form-select {
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 0.2rem rgba(26, 115, 232, 0.15);
        }

        /* Payment Type Selection */
        .payment-type-options {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .payment-type-option {
            flex: 1;
            position: relative;
        }

        .payment-type-option input[type="radio"] {
            display: none;
        }

        .payment-type-option label {
            display: block;
            padding: 1rem;
            text-align: center;
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .payment-type-option input[type="radio"]:checked + label {
            border-color: var(--primary-blue);
            background-color: var(--light-blue);
        }

        /* Template Section Styles */
        .template-section {
            margin-top: 2rem;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
            display: none;
        }

        .template-section.visible {
            opacity: 1;
            transform: translateY(0);
            display: block;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        /* Template Card Styles */
        .template-card {
            border: 1.5px solid #e5e7eb;
            border-radius: 10px;
            padding: 1.2rem 1rem;
            background: #f8faff;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: border 0.2s, box-shadow 0.2s, background 0.2s;
        }
        
        .template-card.selected, .template-card:hover {
            border-color: #2563eb;
            background: #f0f6ff;
        }
        
        .template-card input[type="radio"] {
            display: none;
        }
        
        .template-content {
            padding: 1.25rem;
        }

        .template-content h6 {
            margin: 0 0 0.5rem 0;
            color: #2563eb;
        }

        .template-content p {
            margin: 0;
        }

        /* Button Styles */
        .btn-send {
            width: 100%;
            padding: 1rem;
            font-size: 1.1rem;
            font-weight: 500;
            background: var(--primary-blue);
            border: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            margin-top: 2rem;
        }

        .btn-send:hover {
            background: var(--dark-blue);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(26, 115, 232, 0.2);
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--white);
            padding: 0.75rem;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .nav-buttons {
            display: flex;
            justify-content: space-around;
            max-width: 800px;
            margin: 0 auto;
        }

        .nav-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.5rem 1rem;
            color: var(--text-light);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            flex: 1;
            text-align: center;
        }

        .nav-button.active {
            color: var(--primary-blue);
            background: var(--light-blue);
        }

        .nav-button i {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }

        .nav-button span {
            font-size: 0.875rem;
            font-weight: 500;
        }

        /* Loading State */
        .loading {
            position: relative;
            pointer-events: none;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: var(--primary-blue);
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            body {
                padding: 0.5rem;
            }

            .main-container {
                padding: 1.5rem;
                margin: 0;
                border-radius: 12px;
            }

            .logo-container img {
                max-width: 140px;
            }

            .template-content {
                padding: 1rem;
            }

            .form-control, .form-select {
                font-size: 16px;
            }

            .btn-send {
                padding: 0.875rem;
                font-size: 1rem;
            }

            .payment-type-options {
                flex-direction: column;
            }

            .nav-button {
                padding: 0.5rem;
            }

            .nav-button span {
                font-size: 0.75rem;
            }
        }

        @media (max-width: 480px) {
            .main-container {
                padding: 1rem;
            }

            .template-grid {
                grid-template-columns: 1fr;
            }

            .nav-button {
                padding: 0.5rem 0.25rem;
            }

            .nav-button i {
                font-size: 1.25rem;
            }

            .nav-button span {
                font-size: 0.7rem;
            }
        }

        /* Section Titles */
        .section-title {
            color: var(--primary-blue);
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--light-blue);
        }

        /* Form Sections */
        .form-section {
            background: var(--gray-100);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        /* Installment Amount Display */
        #installmentAmount {
            margin-top: 1rem;
            font-size: 0.95rem;
        }

        #installmentAmount strong {
            color: var(--primary-blue);
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .section-title {
                font-size: 1rem;
            }

            .form-section {
                padding: 1rem;
            }
        }

        /* Form Validation Styles */
        .form-control.is-invalid,
        .form-select.is-invalid {
            border-color: #dc3545;
            padding-right: calc(1.5em + 0.75rem);
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23dc3545' stroke='none'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right calc(0.375em + 0.1875rem) center;
            background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
        }

        .form-control.is-valid,
        .form-select.is-valid {
            border-color: #198754;
            padding-right: calc(1.5em + 0.75rem);
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='%23198754' d='M2.3 6.73L.6 4.53c-.4-1.04.46-1.4 1.1-.8l1.1 1.4 3.4-3.8c.6-.63 1.6-.27 1.2.7l-4 4.6c-.43.5-.8.4-1.1.1z'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right calc(0.375em + 0.1875rem) center;
            background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
        }

        /* Installment Amount Display */
        #installmentAmount {
            margin-top: 1rem;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        #installmentAmount.valid {
            background-color: #d1e7dd;
            border-color: #badbcc;
            color: #0f5132;
        }

        #installmentAmount.invalid {
            background-color: #f8d7da;
            border-color: #f5c2c7;
            color: #842029;
        }

        /* Disabled State */
        .form-select:disabled {
            background-color: #e9ecef;
            cursor: not-allowed;
        }

        /* Template Styles */
        .template-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .template-card {
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            padding: 1rem;
            transition: all 0.3s ease;
            background: white;
            height: 100%;
        }

        .template-card:hover {
            border-color: var(--primary);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .template-title {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .template-preview {
            white-space: pre-wrap;
            font-size: 0.9rem;
            color: var(--gray-700);
            margin-top: 0.5rem;
            padding: 0.75rem;
            background: var(--gray-50);
            border-radius: 4px;
            line-height: 1.5;
            max-height: 200px;
            overflow-y: auto;
        }

        .form-check-input:checked + .form-check-label .template-card {
            border-color: var(--primary);
            background: var(--primary-50);
        }

        .form-check {
            margin: 0;
            height: 100%;
        }

        .form-check-label {
            width: 100%;
            cursor: pointer;
            display: block;
            height: 100%;
        }

        @media (max-width: 768px) {
            .template-options {
                grid-template-columns: 1fr;
            }
        }

        .input-group {
            display: flex;
            width: 100%;
        }
        .input-group-text {
            display: flex;
            align-items: center;
            padding: 0 1rem;
            background: #f8fafc;
            border: 1px solid #e5e7eb;
            border-right: none;
            border-radius: 8px 0 0 8px;
            font-size: 1rem;
            color: #2563eb;
            height: 48px; /* igual ao input */
        }
        .form-control {
            border-radius: 0 8px 8px 0;
            border-left: none;
            height: 48px;
            font-size: 1rem;
            background: #f8fafc;
            border: 1px solid #e5e7eb;
            width: 100%;
            box-sizing: border-box;
        }
        .input-group input:focus, .input-group .form-control:focus {
            border-color: #2563eb;
            outline: none;
            z-index: 2;
        }

        .payment-type-cards {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        .payment-type-card {
            flex: 1 1 220px;
            background: #f8fafc;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(37,99,235,0.04);
            padding: 1.2rem 1rem 1.2rem 3rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: border 0.2s, box-shadow 0.2s, background 0.2s;
            position: relative;
            min-width: 180px;
            margin-bottom: 0.5rem;
            user-select: none;
        }
        .payment-type-card input[type="radio"] {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%) scale(1.2);
            accent-color: #2563eb;
            margin: 0;
            z-index: 2;
        }
        .payment-type-card .card-content {
            margin-left: 0;
        }
        .payment-type-card .card-title {
            font-weight: 600;
            color: #2563eb;
            font-size: 1.1rem;
            margin-bottom: 0.3rem;
        }
        .payment-type-card .card-desc {
            color: #374151;
            font-size: 0.97rem;
        }
        .payment-type-card input[type="radio"]:checked ~ .card-content,
        .payment-type-card.selected {
            border-color: #2563eb;
            background: #f0f6ff;
            box-shadow: 0 4px 16px rgba(37,99,235,0.10);
        }
        .payment-type-card input[type="radio"]:focus ~ .card-content {
            outline: 2px solid #2563eb;
        }
        @media (max-width: 700px) {
            .payment-type-cards {
                flex-direction: column;
                gap: 0.7rem;
            }
            .payment-type-card {
                min-width: 0;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container main-container">
        <!-- Logo Section -->
        <div class="logo-container">
            <img src="https://static.wixstatic.com/media/030da1_fec378b6fe8d4ee2b9a5a51b96f6febb~mv2.png/v1/fill/w_132,h_68,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/Logo.png" 
                 alt="Autoescola Ideal Logo" 
                 class="img-fluid">
        </div>

        <!-- Message Tab Content -->
        <div id="messageTab" class="tab-content active">
            <form id="messageForm" class="needs-validation" novalidate>
                <div class="mb-3">
                    <label for="fullName" class="form-label">Nome Completo</label>
                    <input type="text" class="form-control" id="fullName" required>
                    <div class="invalid-feedback">Por favor, insira o nome completo.</div>
                </div>
                <div class="mb-3">
                    <label for="whatsapp" class="form-label">WhatsApp</label>
                    <input type="tel" class="form-control" id="whatsapp" required>
                    <div class="invalid-feedback">Por favor, insira um número de WhatsApp válido.</div>
                </div>
                <div class="mb-3">
                    <label for="messageType" class="form-label">Tipo de Mensagem</label>
                    <select class="form-select" id="messageType" required>
                        <option value="">Selecione o tipo</option>
                        <option value="boas-vindas">Boas-vindas</option>
                        <option value="chamada">Chamada de Cliente</option>
                    </select>
                    <div class="invalid-feedback">Por favor, selecione o tipo de mensagem.</div>
                </div>
                
                <div id="templateSection" style="display:none;">
                    <div class="template-options"></div>
                </div>

                <button type="submit" class="btn btn-primary w-100">
                    <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                    Enviar Mensagem
                </button>
            </form>
        </div>

        <!-- Payment Tab Content -->
        <div id="paymentTab" class="tab-content">
            <form id="paymentForm" class="needs-validation" novalidate>
                <div class="mb-3">
                    <label for="paymentUnit" class="form-label">Unidade de Cadastro</label>
                    <select class="form-select" id="paymentUnit" required disabled>
                        <option value="">Selecione a unidade</option>
                        <option value="vila helena">Vila Helena</option>
                        <option value="vila progresso">Vila Progresso</option>
                        <option value="aparecidinha">Aparecidinha</option>
                        <option value="julio de mesquita">Julio de Mesquita</option>
                        <option value="vila haro">Vila Haro</option>
                        <option value="coop">Coop</option>
                    </select>
                    <div class="invalid-feedback">
                        Por favor, selecione uma unidade.
                    </div>
                </div>

                <div class="payment-type-cards">
                    <label class="payment-type-card">
                        <input type="radio" name="paymentType" value="boleto" required>
                        <span>
                            <div class="card-title">Boleto</div>
                            <div class="card-desc">Pagamento via boleto bancário</div>
                        </span>
                    </label>
                    <label class="payment-type-card">
                        <input type="radio" name="paymentType" value="pix" required>
                        <span>
                            <div class="card-title">Pix</div>
                            <div class="card-desc">Pagamento instantâneo via Pix</div>
                        </span>
                    </label>
                </div>

                <!-- Campos para Pix -->
                <div id="pixFields" style="display:none;">
                    <h5>Dados para Pagamento via Pix</h5>
                    <label for="pixKeyType" class="form-label">Tipo de chave Pix</label>
                    <select id="pixKeyType" class="form-select" required>
                        <option value="">Selecione o tipo de chave</option>
                        <option value="celular">Celular</option>
                        <option value="copiaecola">Copia e Cola</option>
                        <option value="email">E-mail</option>
                        <option value="cpf">CPF</option>
                        <option value="cnpj">CNPJ</option>
                    </select>
                    <label for="pixKey" class="form-label">Chave Pix</label>
                    <input type="text" id="pixKey" class="form-control" required>
                    <label for="favorecidoPix" class="form-label">Nome do favorecido ou Razão Social</label>
                    <input type="text" id="favorecidoPix" class="form-control" required>
                    <label for="cpfCnpjFavorecidoPix" class="form-label">CPF ou CNPJ do favorecido</label>
                    <input type="text" id="cpfCnpjFavorecidoPix" class="form-control" required>
                    <label for="valorPix" class="form-label">Valor</label>
                    <input type="number" id="valorPix" class="form-control" min="0" step="0.01" required>
                    <label for="vencimentoPix" class="form-label">Data de Vencimento</label>
                    <input type="date" id="vencimentoPix" class="form-control" required>
                    <label for="descricaoPix" class="form-label">Descrição</label>
                    <input type="text" id="descricaoPix" class="form-control" required>
                </div>

                <!-- Campos para Boleto -->
                <div id="boletoFields" style="display:none;">
                    <h5>Dados para Pagamento via Boleto</h5>
                    <label for="beneficiaryBoleto" class="form-label">Nome do Beneficiário</label>
                    <input type="text" class="form-control" id="beneficiaryBoleto" required>
                    <label for="cpfCnpjBeneficiaryBoleto" class="form-label">CPF ou CNPJ do Beneficiário</label>
                    <input type="text" class="form-control" id="cpfCnpjBeneficiaryBoleto" required>
                    <label for="amountBoleto" class="form-label">Valor a Pagar</label>
                    <input type="number" class="form-control" id="amountBoleto" min="0" step="0.01" required>
                    <label for="dueDateBoleto" class="form-label">Data de Vencimento</label>
                    <input type="date" class="form-control" id="dueDateBoleto" required>
                    <label for="descricaoBoleto" class="form-label">Descrição ou Observações</label>
                    <input type="text" class="form-control" id="descricaoBoleto" required>
                </div>

                <button type="submit" class="btn-primary">Registrar Pagamento</button>
            </form>
        </div>

        <!-- Charge Tab Content -->
        <div id="chargeTab" class="tab-content">
            <form id="chargeForm" class="needs-validation" novalidate>
                <!-- Client Information Section -->
                <div class="mb-4">
                    <h5 class="section-title">Informações do Cliente</h5>
                    <div class="row g-3">
                        <!-- Full Name Input -->
                        <div class="col-md-6">
                            <label for="clientName" class="form-label">Nome Completo</label>
                            <input type="text" class="form-control" id="clientName" required>
                            <div class="invalid-feedback">
                                Por favor, insira o nome completo.
                            </div>
                        </div>

                        <!-- CPF Input -->
                        <div class="col-md-6">
                            <label for="clientCPF" class="form-label">CPF</label>
                            <input type="text" class="form-control" id="clientCPF" 
                                   pattern="[0-9]{11}" required>
                            <div class="invalid-feedback">
                                Por favor, insira um CPF válido (11 dígitos).
                            </div>
                        </div>

                        <!-- Client Email Input -->
                        <div class="col-md-6">
                            <label for="clientEmail" class="form-label">E-mail</label>
                            <input type="email" class="form-control" id="clientEmail" required>
                            <div class="invalid-feedback">
                                Por favor, insira um e-mail válido.
                            </div>
                        </div>

                        <!-- Client Phone Input -->
                        <div class="col-md-6">
                            <label for="clientPhone" class="form-label">WhatsApp</label>
                            <input type="tel" class="form-control" id="clientPhone" 
                                   pattern="[0-9]{10,11}" required>
                            <div class="invalid-feedback">
                                Por favor, insira um número válido (10 ou 11 dígitos).
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Service Information Section -->
                <div class="mb-4">
                    <h5 class="section-title">Informações do Serviço</h5>
                    <div class="row g-3">
                        <!-- Branch Selection -->
                        <div class="col-md-6">
                            <label for="branch" class="form-label">Unidade de Cadastro</label>
                            <select class="form-select" id="branch" required disabled>
                                <option value="">Selecione a unidade</option>
                                <option value="vila helena">Vila Helena</option>
                                <option value="vila progresso">Vila Progresso</option>
                                <option value="aparecidinha">Aparecidinha</option>
                                <option value="julio de mesquita">Julio de Mesquita</option>
                                <option value="vila haro">Vila Haro</option>
                                <option value="coop">Coop</option>
                            </select>
                            <div class="invalid-feedback">
                                Por favor, selecione uma unidade.
                            </div>
                        </div>

                        <!-- Category Selection -->
                        <div class="col-md-6">
                            <label for="category" class="form-label">Categoria</label>
                            <select class="form-select" id="category" required>
                                <option value="">Selecione a categoria</option>
                                <option value="1º CNH A">1º CNH A</option>
                                <option value="1º CNH B COM SIMULADOR">1º CNH B COM SIMULADOR</option>
                                <option value="1º CNH A/B COM SIMULADOR">1º CNH A/B COM SIMULADOR</option>
                                <option value="1º CNH B SEM SIMULADOR">1º CNH B SEM SIMULADOR</option>
                                <option value="1º CNH A/B SEM SIMULADOR">1º CNH A/B SEM SIMULADOR</option>
                                <option value="ADIÇÃO A">ADIÇÃO A</option>
                                <option value="ADIÇÃO B">ADIÇÃO B</option>
                                <option value="MUDANÇA CATEGORIA D">MUDANÇA CATEGORIA D</option>
                                <option value="ADIÇÃO A/D">ADIÇÃO A/D</option>
                                <option value="AULA EXTRA">AULA EXTRA</option>
                                <option value="CURSO CFCA">CURSO CFCA</option>
                            </select>
                            <div class="invalid-feedback">
                                Por favor, selecione uma categoria.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Payment Information Section -->
                <div class="mb-4">
                    <h5 class="section-title">Informações de Pagamento</h5>
                    <div class="row g-3">
                        <!-- Payment Method -->
                        <div class="col-md-6">
                            <label for="paymentMethod" class="form-label">Método de Pagamento</label>
                            <select class="form-select" id="paymentMethod" required>
                                <option value="">Selecione o método</option>
                                <option value="Avista">À Vista</option>
                                <option value="Boleto">Boleto</option>
                                <option value="Cartão de Crédito">Cartão de Crédito</option>
                                <option value="Crédito Recorrente">Crédito Recorrente</option>
                            </select>
                            <div class="invalid-feedback">
                                Por favor, selecione um método de pagamento.
                            </div>
                        </div>

                        <!-- Total Amount -->
                        <div class="col-md-6">
                            <label for="valorTotal" class="form-label">Valor Total</label>
                            <div class="input-group">
                                <span class="input-group-text">R$</span>
                                <input type="number" class="form-control" id="valorTotal" min="0" step="0.01" required>
                            </div>
                            <div class="invalid-feedback">
                                Por favor, insira o valor total.
                            </div>
                        </div>

                        <!-- Installments Section (always visible) -->
                        <div class="col-md-6">
                            <label for="installments" class="form-label">Número de Parcelas</label>
                            <select class="form-select" id="installments" required>
                                <option value="1">1x</option>
                                <option value="2">2x</option>
                                <option value="3">3x</option>
                                <option value="4">4x</option>
                                <option value="5">5x</option>
                                <option value="6">6x</option>
                                <option value="7">7x</option>
                                <option value="8">8x</option>
                                <option value="9">9x</option>
                                <option value="10">10x</option>
                                <option value="11">11x</option>
                                <option value="12">12x</option>
                            </select>
                            <div class="invalid-feedback">
                                Por favor, selecione o número de parcelas.
                            </div>
                        </div>

                        <!-- First Due Date -->
                        <div class="col-md-6">
                            <label for="firstDueDate" class="form-label">Data do Primeiro Vencimento</label>
                            <input type="date" class="form-control" id="firstDueDate" required>
                            <div class="invalid-feedback">
                                Por favor, selecione a data do primeiro vencimento.
                            </div>
                        </div>

                        <!-- Installment Amount Display -->
                        <div class="col-12">
                            <div class="alert alert-info" id="installmentAmount" style="display: none;">
                                Valor por parcela: <strong>R$ 0,00</strong>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Submit Button -->
                <button type="submit" class="btn btn-primary btn-send">
                    Registrar Cobrança
                </button>
            </form>
        </div>

        <!-- Unit Statement Tab Content -->
        <div id="statementTab" class="tab-content">
            <div class="statement-container">
                <!-- Unit Display -->
                <div class="unit-display mb-4">
                    <h5 class="section-title">Extrato da Unidade: <span id="currentUnit" class="text-primary"></span></h5>
                </div>

                <!-- Google Sheets Embed Container -->
                <div class="sheet-container">
                    <iframe id="sheetFrame" 
                            width="100%" 
                            height="600" 
                            frameborder="0" 
                            allowfullscreen>
                    </iframe>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <div class="nav-buttons">
            <a href="#" class="nav-button active" data-tab="messageTab">
                <i class="bi bi-chat-dots"></i>
                <span>Enviar Mensagem</span>
            </a>
            <a href="#" class="nav-button" data-tab="paymentTab">
                <i class="bi bi-cash-coin"></i>
                <span>Cadastrar Contas BTG</span>
            </a>
            <a href="#" class="nav-button" data-tab="chargeTab">
                <i class="bi bi-receipt"></i>
                <span>Registrar Cobrança</span>
            </a>
            <a href="#" class="nav-button" data-tab="statementTab">
                <i class="bi bi-file-earmark-spreadsheet"></i>
                <span>Extrato Unidade</span>
            </a>
        </div>
    </nav>

    <!-- Bootstrap JS and Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JavaScript -->
    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar se o usuário está logado
            if (!localStorage.getItem('isLoggedIn')) {
                window.location.href = 'login.html';
            }

            // Obter a unidade selecionada no login
            const selectedUnit = localStorage.getItem('selectedUnit');
            
            // Selecionar a unidade nos campos de branch
            const branchSelect = document.getElementById('branch');
            const paymentUnitSelect = document.getElementById('paymentUnit');
            
            if (branchSelect) {
                branchSelect.value = selectedUnit;
            }
            if (paymentUnitSelect) {
                paymentUnitSelect.value = selectedUnit;
            }

            // Atualizar o título do extrato com a unidade atual
            const currentUnitElement = document.getElementById('currentUnit');
            if (currentUnitElement) {
                // Formatar o nome da unidade para exibição
                const unitDisplayName = selectedUnit
                    .split(' ')
                    .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                    .join(' ');
                currentUnitElement.textContent = unitDisplayName;
            }

            // Configurar o iframe do Google Sheets baseado na unidade
            const sheetFrame = document.getElementById('sheetFrame');
            if (sheetFrame) {
                const sheetIds = {
                    'aparecidinha': '1bGxiQIi5aB3faiW9US6mOsR-M_KjPiTLaPq15zQBMx8',
                    'coop': '1wdIYUoI_hdzuey4p51EFnQgRG2r0QlhhmnmZbpKtqoE',
                    'julio de mesquita': '1FRMHgo95GcZrzmRWnGJc2AfEN_lELfbOQr1r0HzBiiI',
                    'vila haro': '1o4TQg7jgpbUP6yUBEDN8cL6yXqGm3zawgjqNFQlr0qU',
                    'vila helena': '1rJAA5f_svrD_j_NAFDFisFsA1CeRGakH-c4yHYm6OFM',
                    'vila progresso': '1iysHQKpov_ZTDGtd7p4Qv2cYotnmUZ6fA5tnuHu0RG0'
                };

                const sheetId = sheetIds[selectedUnit];
                if (sheetId) {
                    sheetFrame.src = `https://docs.google.com/spreadsheets/d/${sheetId}/preview`;
                }
            }

            const templates = {
                'boas-vindas': [
                    {
                        id: 'boas-vindas-1',
                        title: 'Boas-Vindas',
                        text: `Bem-vindo(a) à Autoescola Ideal <span style="color:#1a73e8;">{{primeiro nome}}</span>!
É uma alegria ter você como nosso aluno! A partir de agora, começa sua jornada rumo à conquista da CNH com uma equipe pronta para te orientar em todas as etapas.

📲 Acompanhe tudo pelo app "Minha Habilitação". Nele, você acessa agendamentos, exames, andamento do processo e pendências.

Seu acesso é o CPF e a senha padrão 123456.

🩺 Agende seus exames obrigatórios o quanto antes! Quanto mais rápido realizar, mais cedo poderá avançar.

📍Caso tenha dúvidas, nossa equipe está à disposição para te ajudar!

👩‍🏫 Conte com a equipe Ideal para uma experiência prática, tranquila e de qualidade em cada etapa.

💙 Seja muito bem-vindo(a) mais uma vez — você está em boas mãos!`
                    }
                ],
                'chamada': [
                    {
                        id: 'chamada-1',
                        title: 'Chamada de Cliente 1',
                        text: `Atualização de atendimento!
Olá <span style="color:#1a73e8;">{{primeiro nome}}</span>, tudo bem? Passando para te informar que recentemente realizamos uma atualização em nossa plataforma de atendimento via WhatsApp.

📆 Se você nos enviou alguma mensagem no dia 06/06 e não recebeu retorno, pedimos gentilmente que nos envie novamente sua dúvida ou solicitação.

Pedimos desculpas pelo transtorno causado e agradecemos imensamente sua compreensão. Estamos à disposição para te atender com toda atenção que você merece! 💙`
                    },
                    {
                        id: 'chamada-2',
                        title: 'Chamada de Cliente 2',
                        text: `Olá <span style="color:#1a73e8;">{{primeiro nome}}</span>
Seja muito bem-vindo(a) à nossa Central Oficial e Verificada do Grupo Ideal Sorocaba! Este novo canal de atendimento foi criado para oferecer um contato ainda mais ágil, seguro e estável com você.

Por favor, salve este número para receber lembretes, novidades e todo tipo de comunicação relacionada à sua unidade de ensino.

Agradecemos a sua compreensão e pedimos desculpas por qualquer transtorno causado durante essa transição. Conte sempre conosco!

Atenciosamente,
Equipe Grupo Ideal Sorocaba`
                    },
                    
                    
                ]
            };

            const messageTypeSelect = document.getElementById('messageType');
            const templateSection = document.getElementById('templateSection');
            const templateOptions = templateSection.querySelector('.template-options');
            const fullNameInput = document.getElementById('fullName');
            const form = document.getElementById('messageForm');
            const submitBtn = form.querySelector('button[type=submit]');
            const spinner = submitBtn.querySelector('.spinner-border');

            function getFirstName(fullName) {
                const first = (fullName || '').split(' ')[0] || '';
                return first.charAt(0).toUpperCase() + first.slice(1).toLowerCase();
            }

            function showTemplates(type, firstName) {
                templateOptions.innerHTML = '';
                if (!type || !templates[type]) {
                    templateSection.style.display = 'none';
                    return;
                }
                templates[type].forEach(template => {
                    // Substitui {{primeiro nome}} pelo nome real, colorido
                    const contentWithName = template.text.replace(/{{primeiro nome}}/g, `<span style="color:#1a73e8;">${firstName}</span>`).replace(/\n/g, '<br>');
                    const card = document.createElement('div');
                    card.className = 'template-card';
                    card.innerHTML = `
                        <input type="radio" name="template" id="${template.id}" value="${template.id}" required>
                        <div class="template-content">
                            <h6>${template.title}</h6>
                            <p>${contentWithName}</p>
                        </div>
                    `;
                    card.addEventListener('click', function() {
                        const radio = this.querySelector('input[type="radio"]');
                        radio.checked = true;
                        document.querySelectorAll('.template-card').forEach(c => c.classList.remove('selected'));
                        this.classList.add('selected');
                    });
                    templateOptions.appendChild(card);
                });
                const firstCard = templateOptions.querySelector('.template-card');
                if (firstCard) {
                    firstCard.classList.add('selected');
                    firstCard.querySelector('input[type="radio"]').checked = true;
                }
                templateSection.style.display = 'block';
            }

            messageTypeSelect.addEventListener('change', function() {
                showTemplates(this.value, getFirstName(fullNameInput.value));
                templateSection.style.display = templates[this.value] ? 'block' : 'none';
            });

            fullNameInput.addEventListener('input', function() {
                if (messageTypeSelect.value) {
                    showTemplates(messageTypeSelect.value, getFirstName(this.value));
                }
            });

            templateSection.style.display = 'none';

            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                if (!form.checkValidity()) {
                    form.classList.add('was-validated');
                    return;
                }
                const fullName = fullNameInput.value;
                const whatsapp = document.getElementById('whatsapp').value;
                const messageType = messageTypeSelect.value;
                const selectedTemplate = document.querySelector('input[name="template"]:checked');
                if (!selectedTemplate) {
                    alert('Por favor, selecione um template.');
                    return;
                }
                const templateId = selectedTemplate.value;
                const template = templates[messageType].find(t => t.id === templateId);
                const firstName = getFirstName(fullName);
                // Substitui {{primeiro nome}} pelo nome real no envio
                const message = template.text.replace(/{{primeiro nome}}/g, firstName);
                const payload = {
                    fullName,
                    firstName,
                    whatsapp,
                    message,
                    messageType,
                    templateTitle: template.title, // Nome do template selecionado
                    pixKeyType: document.getElementById('pixKeyType').value,
                    pixKey: document.getElementById('pixKey').value,
                    favorecido: document.getElementById('favorecidoPix').value,
                    cpfCnpjFavorecido: document.getElementById('cpfCnpjFavorecidoPix').value,
                    valor: document.getElementById('valorPix').value,
                    descricao: document.getElementById('descricaoPix').value,
                    vencimento: document.getElementById('vencimentoPix').value
                };
                submitBtn.disabled = true;
                spinner.style.display = 'inline-block';
                try {
                    const response = await fetch('https://hook.us2.make.com/6o2ul55xv36k4wmxo12ctnwrn2rw1779', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (response.ok) {
                        alert('Mensagem enviada com sucesso!');
                        form.reset();
                        form.classList.remove('was-validated');
                        templateSection.style.display = 'none';
                    } else {
                        throw new Error('Erro ao enviar mensagem');
                    }
                } catch (error) {
                    alert('Erro ao enviar mensagem. Por favor, tente novamente.');
                } finally {
                    submitBtn.disabled = false;
                    spinner.style.display = 'none';
                }
            });

            const paymentForm = document.getElementById('paymentForm');
            const paymentTypeRadios = paymentForm.querySelectorAll('input[name="paymentType"]');
            const pixFields = document.getElementById('pixFields');
            const boletoFields = document.getElementById('boletoFields');

            function togglePaymentFields() {
                const selected = paymentForm.querySelector('input[name="paymentType"]:checked');
                if (selected && selected.value === 'pix') {
                    pixFields.style.display = 'block';
                    boletoFields.style.display = 'none';
                    pixFields.querySelectorAll('input,select').forEach(el => el.required = true);
                    boletoFields.querySelectorAll('input,select').forEach(el => el.required = false);
                } else if (selected && selected.value === 'boleto') {
                    pixFields.style.display = 'none';
                    boletoFields.style.display = 'block';
                    pixFields.querySelectorAll('input,select').forEach(el => el.required = false);
                    boletoFields.querySelectorAll('input,select').forEach(el => el.required = true);
                } else {
                    pixFields.style.display = 'none';
                    boletoFields.style.display = 'none';
                    pixFields.querySelectorAll('input,select').forEach(el => el.required = false);
                    boletoFields.querySelectorAll('input,select').forEach(el => el.required = false);
                }
            }

            paymentTypeRadios.forEach(radio => {
                radio.addEventListener('change', togglePaymentFields);
            });

            togglePaymentFields(); // on page load

            paymentForm.addEventListener('submit', function(event) {
                if (!paymentForm.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();
                    paymentForm.classList.add('was-validated');
                    return;
                }
                // Aqui você pode enviar os dados para o backend/webhook
                event.preventDefault();
                alert('Pagamento registrado!');
            });

            document.querySelectorAll('.payment-type-card input[type="radio"]').forEach(input => {
                input.addEventListener('change', function() {
                    document.querySelectorAll('.payment-type-card').forEach(card => card.classList.remove('selected'));
                    if (input.checked) input.closest('.payment-type-card').classList.add('selected');
                });
            });
        });
    </script>
</body>
</html> 